// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider = "postgresql"
}

enum TwilioMessageStatus {
  SENT
  UNDELIVERED
  DELIVERED
  FAILED
}

model Folder {
  id          Int     @id @default(autoincrement())
  name        String
  dropboxPath String  @unique
  images      Image[] // Relation: A folder can have many images
}

// Defines the Image model that will become a table in your database
model Image {
  id          Int    @id @default(autoincrement()) // Standard auto-incrementing primary key
  dropboxPath String @unique // The unique path of the file in Dropbox, prevents duplicates
  url         String // The public URL to the image for the frontend to use

  wasShown     Boolean @default(false) // This is the key to your no-repeat logic
  isTodaysPick Boolean @default(false) // A simple flag to mark the 3 images for the current day

  createdAt DateTime @default(now()) // Tracks when the record was created
  updatedAt DateTime @updatedAt // Tracks the last time the record was updated

  folderId Int
  folder   Folder @relation(fields: [folderId], references: [id])

  histories history[]
  logs      logs[]
}

model logs {
  id        Int                 @id @default(autoincrement())
  action    String
  msgId     String?
  imageId   Int
  status    TwilioMessageStatus
  updatedAt DateTime            @updatedAt
  createdAt DateTime            @default(now())

  image Image @relation(fields: [imageId], references: [id])
}

model history {
  id        Int      @id @default(autoincrement())
  imageId   Int
  count     Int
  month     String
  year      Int
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
  image     Image    @relation(fields: [imageId], references: [id])
}
